[env:seeed_xiao_esp32c3]
platform = espressif32
board = seeed_xiao_esp32c3
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; Xiao-optimierte Build-Flags
build_flags = 
    ; Debug & Logging (reduziert für Speicher)
    -DCORE_DEBUG_LEVEL=2
    -DCONFIG_ARDUHAL_LOG_COLORS=1
    
    ; KERNEL-FEATURES BEIBEHALTEN
    -DDYNAMIC_LIBRARY_SUPPORT=1
    -DHIERARCHICAL_ZONES=1
    -DOTA_LIBRARY_ENABLED=1
    -DSAFE_MODE_PROTECTION=1
    -DZONE_MASTER_ENABLED=1
    
    ; THREAD-SAFETY (Phase 6+) - Aktiviert Mutex-Schutz in StorageManager
    -DCONFIG_ENABLE_THREAD_SAFETY
    
    ; Xiao-spezifische Anpassungen
    -DXIAO_ESP32C3_MODE=1
    -DMAX_SENSORS=10
    -DMAX_ACTUATORS=6
    -DMAX_LIBRARY_SIZE=32768
    -DMQTT_MAX_PACKET_SIZE=1024
    -DMQTT_KEEPALIVE=60
    -DMQTT_SOCKET_TIMEOUT=60
    -DWIFI_CONNECT_TIMEOUT=10000
    -DCONFIG_ESP32_WIFI_STATIC_RX_BUFFER_NUM=8

; Partitionierung für Xiao
board_build.partitions = default.csv
board_build.filesystem = spiffs

; Libraries (nur Basis-Libraries)
lib_deps = 
    knolleary/PubSubClient@^2.8
    bblanchon/ArduinoJson@^6.21.3
    arduino-libraries/NTPClient@^3.2.1
    paulstoffregen/OneWire@^2.3.7
    milesburton/DallasTemperature@^3.11.0
    WebServer
    DNSServer

monitor_filters =
    esp32_exception_decoder
    time
    colorize
    log2file
    default
    debug
    send_on_enter

; =============================================================================
; ESP32 DEV ENVIRONMENT - Entwicklungs-Board
; =============================================================================

[env:esp32_dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; ESP32 Dev Build-Flags
build_flags = 
    ; Debug & Logging (erweitert für ESP32 Dev)
    -DCORE_DEBUG_LEVEL=3
    -DCONFIG_ARDUHAL_LOG_COLORS=1
    
    ; KERNEL-FEATURES BEIBEHALTEN
    -DDYNAMIC_LIBRARY_SUPPORT=1
    -DHIERARCHICAL_ZONES=1
    -DOTA_LIBRARY_ENABLED=1
    -DSAFE_MODE_PROTECTION=1
    -DZONE_MASTER_ENABLED=1
    
    ; THREAD-SAFETY (Phase 6+) - Aktiviert Mutex-Schutz in StorageManager
    -DCONFIG_ENABLE_THREAD_SAFETY
    
    ; ESP32 Dev-spezifische Anpassungen
    -DESP32_DEV_MODE=1
    -DMAX_SENSORS=20
    -DMAX_ACTUATORS=12
    -DMAX_LIBRARY_SIZE=65536
    -DMQTT_MAX_PACKET_SIZE=2048
    -DMQTT_KEEPALIVE=60
    -DMQTT_SOCKET_TIMEOUT=60
    -DWIFI_CONNECT_TIMEOUT=10000
    -DCONFIG_ESP32_WIFI_STATIC_RX_BUFFER_NUM=16

; Partitionierung für ESP32 Dev
board_build.partitions = default.csv
board_build.filesystem = spiffs

; Libraries (erweiterte Auswahl für ESP32 Dev)
lib_deps = 
    knolleary/PubSubClient@^2.8
    bblanchon/ArduinoJson@^6.21.3
    arduino-libraries/NTPClient@^3.2.1
    paulstoffregen/OneWire@^2.3.7
    milesburton/DallasTemperature@^3.11.0
    WebServer
    DNSServer
    adafruit/Adafruit Unified Sensor@^1.1.9
    adafruit/Adafruit BME280 Library@^2.2.2

monitor_filters =
    esp32_exception_decoder
    time
    colorize
    log2file
    default
    debug
    send_on_enter

; =============================================================================
; WOKWI SIMULATION ENVIRONMENT
; =============================================================================
; Purpose: Test real ESP32 firmware in Wokwi virtual environment
;
; Usage:
;   Build:   pio run -e wokwi_simulation
;   Run:     wokwi-cli run --timeout 60000
;   CI:      wokwi-cli run --scenario tests/wokwi/boot_test.yaml
;
; Documentation: https://docs.wokwi.com/

[env:wokwi_simulation]
extends = env:esp32_dev
build_flags =
    ${env:esp32_dev.build_flags}
    ; Wokwi Simulation Mode
    -D WOKWI_SIMULATION=1
    ; WiFi credentials for Wokwi (Wokwi-GUEST is open network)
    -D WOKWI_WIFI_SSID=\"Wokwi-GUEST\"
    -D WOKWI_WIFI_PASSWORD=\"\"
    ; MQTT broker via Wokwi Gateway (routes to localhost or CI service)
    ; Use host.wokwi.internal - Wokwi's special hostname for host machine
    ; Falls back to actual Windows IP if this doesn't work
    -D WOKWI_MQTT_HOST=\"host.wokwi.internal\"
    -D WOKWI_MQTT_PORT=1883
    ; Optional: Pre-configured ESP ID for reproducible tests
    ; Format must match server pattern: ESP_[A-F0-9]{8}
    -D WOKWI_ESP_ID=\"ESP_00000001\"

; =============================================================================
; TEST ENVIRONMENT
; =============================================================================
; HINWEIS: Test-Kategorisierung erfolgt über PowerShell-Script, nicht über
; separate Environments. Siehe .claude/commands/esp-test-category.md
;
; Usage:
;   /esp-test-category infra        # Nur Infrastructure-Tests
;   /esp-test-category actuator     # Nur Actuator-Tests
;   /esp-test-category sensor       # Nur Sensor-Tests
;   /esp-test-category comm         # Nur Communication-Tests
;   /esp-test-category integration  # Nur Integration-Tests
;   /esp-test-category all          # Alle Kategorien sequentiell
;
; Das Script managed dynamisch welche Test-Dateien im test/ Ordner sind,
; um PlatformIO's Multiple-Definition-Problem zu umgehen.


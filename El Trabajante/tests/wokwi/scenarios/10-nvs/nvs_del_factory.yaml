# NVS Factory Reset Test
# Test-ID: NVS-DEL-004
# CRITICAL: Validates factory reset clears ALL NVS data
# Timeout: 120000ms
#
# Factory reset should:
# - Clear all namespaces (wifi, zone, sensor, actuator, system)
# - ESP32 boots in provisioning mode
# - No leftover configuration data
#
# Expected behavior:
# 1. System receives factory_reset command
# 2. All NVS data erased
# 3. ESP32 reboots
# 4. System enters provisioning/unconfigured state
#
# MQTT injection:
# Topic: kaiser/god/esp/{esp_id}/system/command
# Payload: {"command":"factory_reset","confirm":true}

name: NVS Factory Reset
version: 1
steps:
  # System boots normally first
  - wait-serial: "ESP32 Sensor Network"
  - wait-serial: "StorageManager: Initialized"
  - wait-serial: "MQTT connected successfully"

  # Wait for system to be operational
  - wait-serial: "heartbeat"

  # After MQTT injection of factory_reset command:
  # Look for factory reset acknowledgment
  # Note: Actual factory reset requires MQTT injection
  # This test validates the boot path

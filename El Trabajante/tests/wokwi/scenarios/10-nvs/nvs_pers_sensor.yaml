# NVS Sensor Config Persistence Test
# Test-ID: NVS-PERS-002
# CRITICAL: Validates sensor configuration survives ESP32 reboot
# Timeout: 120000ms (includes reboot time)
#
# This is one of the most important tests!
# Lost sensor configs after power cycle = system failure
#
# Expected behavior:
# 1. Configure sensor via MQTT
# 2. Verify NVS write
# 3. Reboot (simulated via scenario reset)
# 4. Verify sensor is restored from NVS
#
# Note: Wokwi scenario "reset" simulates ESP32 reboot

name: NVS Sensor Config Persistence
version: 1
steps:
  # Initial boot
  - wait-serial: "ESP32 Sensor Network"
  - wait-serial: "StorageManager: Initialized"
  - wait-serial: "MQTT connected successfully"

  # Wait for heartbeat (system operational)
  - wait-serial: "heartbeat"

  # MQTT injection point for sensor configuration:
  # Topic: kaiser/god/esp/{esp_id}/config
  # Payload: {"sensors":[{"gpio":4,"sensor_type":"temp_ds18b20","sensor_name":"PersistTest","active":true,"raw_mode":true}]}
  #
  # After MQTT injection, look for config processing
  - wait-serial: "config"

  # If sensor count is logged, even better
  # The key indicator is that system processes the config

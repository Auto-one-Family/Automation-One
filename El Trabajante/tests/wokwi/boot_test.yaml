# ============================================
# Wokwi Boot Sequence Test
# ============================================
# Purpose: Validate ESP32 firmware boot sequence
#
# Verified Log Messages (from main.cpp, config_manager.cpp):
# - main.cpp:98     "ESP32 Sensor Network v4.0 (Phase 2)"
# - main.cpp:100    "Chip Model: ESP32"
# - main.cpp:114    "Watchdog configured: 30s timeout"
# - gpio_manager.cpp:33  "=== GPIO SAFE-MODE INITIALIZATION ==="
# - main.cpp:192    "Logger system initialized"
# - config_manager.cpp:66  "ConfigManager: WOKWI_SIMULATION mode"
# - main.cpp:416    "Phase 1: Core Infrastructure READY"
# - wifi_manager.cpp:86   "Connecting to WiFi: Wokwi-GUEST"
# - wifi_manager.cpp:140  "WiFi connected! IP: ..."
# - main.cpp:474    "MQTT connected successfully"
# - main.cpp:478    "Initial heartbeat sent"
#
# Usage:
#   wokwi-cli run --timeout 90000 --scenario tests/wokwi/boot_test.yaml

name: Boot Sequence Test
version: 1

steps:
  # ============================================
  # Phase 0: Hardware Initialization
  # ============================================
  - wait-serial: "ESP32 Sensor Network"
    timeout: 10000

  - wait-serial: "Chip Model:"
    timeout: 5000

  - wait-serial: "Watchdog configured"
    timeout: 5000

  # ============================================
  # Phase 1: Core Infrastructure
  # ============================================
  # GPIO Safe-Mode Initialization (gpio_manager.cpp:33)
  - wait-serial: "GPIO SAFE-MODE"
    timeout: 5000

  - wait-serial: "Logger system initialized"
    timeout: 5000

  - wait-serial: "ConfigManager"
    timeout: 5000

  # Wokwi simulation mode confirmation (config_manager.cpp:66)
  - wait-serial: "WOKWI_SIMULATION mode"
    timeout: 5000

  - wait-serial: "Phase 1: Core Infrastructure READY"
    timeout: 10000

  # ============================================
  # Phase 2: Communication Layer
  # ============================================
  - wait-serial: "Phase 2: Communication Layer"
    timeout: 5000

  # WiFi connection (wifi_manager.cpp:86)
  - wait-serial: "Connecting to WiFi:"
    timeout: 5000

  # WiFi connected (wifi_manager.cpp:140) - may take time in Wokwi
  - wait-serial: "WiFi connected"
    timeout: 45000

  # MQTT connection (main.cpp:474)
  - wait-serial: "MQTT connected"
    timeout: 30000

  - wait-serial: "Phase 2: Communication Layer READY"
    timeout: 10000

  # ============================================
  # Phase 3: Hardware Abstraction
  # ============================================
  - wait-serial: "Phase 3: Hardware Abstraction"
    timeout: 5000

  # I2C Bus Manager (i2c_bus.cpp:114)
  - wait-serial: "I2C Bus Manager initialized"
    timeout: 5000

  - wait-serial: "Phase 3: Hardware Abstraction READY"
    timeout: 10000

  # ============================================
  # Phase 4 & 5: Sensor & Actuator
  # ============================================
  - wait-serial: "Phase 4: Sensor System"
    timeout: 5000

  - wait-serial: "Phase 4: Sensor System READY"
    timeout: 10000

  - wait-serial: "Phase 5: Actuator System"
    timeout: 5000

  - wait-serial: "Phase 5: Actuator System READY"
    timeout: 10000

  # ============================================
  # Heartbeat (confirms full boot)
  # ============================================
  # Initial heartbeat (main.cpp:478)
  - wait-serial: "heartbeat"
    timeout: 10000
